<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perfil</title>

  <link rel="stylesheet" href="../style.css">

  <style>
    body {
      padding: 25px;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    .card {
      background: #f4f4f4;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .foto {
      width: 120px;
      height: 120px;
      border-radius: 60px;
      object-fit: cover;
      display: block;
      margin: 0 auto 15px auto;
      border: 3px solid #0a66ff;
    }

    .progress {
      width: 100%;
      background: #ddd;
      height: 10px;
      border-radius: 6px;
      margin-top: 10px;
      overflow: hidden;
    }

    .progress-bar {
      height: 10px;
      background: #0a66ff;
      width: 0%;
    }

    .btn-big {
      width: 100%;
      margin-top: 15px;
    }
  </style>
</head>

<body>

  <h1>Seu Perfil</h1>

  <div class="card">
    <img id="fotoUser" class="foto" src="../assets/user-default.png">

    <button onclick="alterarFoto()" class="btn-big">Alterar Foto</button>

    <input id="fileInput" type="file" accept="image/*" style="display:none;">
  </div>

  <div class="card">
    <h3>Suas Informações</h3>
    <p><strong>Nome:</strong> <span id="nome"></span></p>
    <p><strong>Idade:</strong> <span id="idade"></span></p>
    <p><strong>Email:</strong> <span id="email"></span></p>

    <p><strong>Status:</strong> <span id="statusPremium"></span></p>

    <button onclick="goTo('editar-perfil')" class="btn-big">Editar Perfil</button>
  </div>

  <div class="card">
    <h3>Seu Progresso</h3>
    <p><strong>Dias concluídos:</strong> <span id="dias"></span> / 30</p>

    <div class="progress">
      <div id="barra" class="progress-bar"></div>
    </div>
  </div>

  <button onclick="goTo('home')" class="btn-voltar">Voltar</button>

  <script type="module">
    import { loadDB } from "../database.js";
    import { goTo } from "../navigation.js";

    window.goTo = goTo;

    const nome = document.getElementById("nome");
    const idade = document.getElementById("idade");
    const email = document.getElementById("email");
    const fotoUser = document.getElementById("fotoUser");
    const statusPremium = document.getElementById("statusPremium");
    const dias = document.getElementById("dias");
    const barra = document.getElementById("barra");
    const fileInput = document.getElementById("fileInput");

    function init() {
      const db = loadDB();

      nome.textContent = db.nome || "Não informado";
      idade.textContent = db.idade || "Não informado";
      email.textContent = db.email || "Não informado";

      fotoUser.src = db.foto || "../assets/user-default.png";
      statusPremium.textContent = db.premium ? "Premium" : "Grátis";

      let concluidos = db.cronograma.filter(x => x.status === "done").length;
      dias.textContent = concluidos;

      barra.style.width = (concluidos / 30 * 100) + "%";
    }

    function alterarFoto() {
      fileInput.click();
    }

    fileInput.onchange = function () {
      const file = this.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const db = loadDB();
        db.foto = e.target.result;
        localStorage.setItem("db_lasy", JSON.stringify(db));
        fotoUser.src = e.target.result;
      };
      reader.readAsDataURL(file);
    };

    init();
  </script>

</body>

</html>
